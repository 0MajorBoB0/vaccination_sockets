{% extends "base.html" %}
{% block content %}
<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
  <p style="margin: 0;">Session: <span class="badge mono">{{ session['name'] }}</span></p>
  <span id="socketStatus" style="color: #6b7280; font-size: 14px;">Verbinde...</span>
</div>
<p>Spieler im Raum: <strong id="count">{{ joined }}/{{ session['group_size'] }}</strong></p>
<div class="notice"><ul><li>Bitte warten Sie, bis alle PlÃ¤tze belegt sind.</li><li>Dann startet Runde 1 automatisch.</li></ul></div>
{% endblock %}
{% block scripts %}
<script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
<script>
  const socket = io();
  const statusEl = document.getElementById('socketStatus');
  const countEl = document.getElementById('count');

  socket.on('connect', () => {
    console.log('Socket.IO verbunden:', socket.id);
    statusEl.textContent = 'Live verbunden';
    statusEl.style.color = '#10b981';
    socket.emit('join_lobby', {});
  });

  socket.on('disconnect', () => {
    console.log('Socket.IO getrennt');
    statusEl.textContent = 'Getrennt';
    statusEl.style.color = '#ef4444';
  });

  socket.on('lobby_status', (data) => {
    console.log('Lobby Status:', data);
    countEl.textContent = data.joined + '/' + data.group_size;
    if (data.ready) {
      console.log('Lobby voll, Spiel startet');
      window.location.href = '/round';
    }
  });

  socket.on('lobby_update', (data) => {
    console.log('Neuer Teilnehmer beigetreten:', data.joined);
    socket.emit('join_lobby', {});
  });

  // Session reset - redirect to join page
  socket.on('session_reset', (data) => {
    console.log('ðŸ”„ Session wurde zurÃ¼ckgesetzt:', data.message);
    alert(data.message);
    window.location.href = '/join';
  });
</script>
{% endblock %}