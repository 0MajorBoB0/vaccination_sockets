{% extends "base.html" %}
{% block title %}Vaccination Game – Warten{% endblock %}

{% block content %}
<div class="page">
  <h2>Runde {{ round_number }} – Bitte warten</h2>

  <section class="card">
    <div class="muted">Wir warten, bis alle ihre Entscheidung abgegeben haben…</div>
  </section>

  <section class="card">
    <h3>Status</h3>
    <p>Eingänge: <span id="decided">{{ decided }}</span> / {{ session.group_size }}</p>
  </section>
</div>

<script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
<script>
const sid = "{{ session.id }}";
const roundNo = Number("{{ round_number }}");
const decidedSpan = document.getElementById('decided');

const socket = io();

socket.on('connect', () => {
  console.log('Socket.IO verbunden:', socket.id);
  socket.emit('join_round', {});
});

socket.on('disconnect', () => {
  console.log('Socket.IO getrennt');
});

socket.on('round_status', (data) => {
  console.log('Runden Status:', data);
  decidedSpan.textContent = data.decided ?? 0;
  if (data.ready) {
    console.log('Alle Spieler haben entschieden');
    window.location = "{{ url_for('reveal') }}";
  }
});

socket.on('round_decision', (data) => {
  console.log('Spieler hat entschieden, Runde', data.round);
  socket.emit('join_round', {});
});
</script>

<style>
.page { display:flex; flex-direction:column; gap:1rem; }
.card { background:#0b1320; border:1px solid #1e2b43; border-radius:10px; padding:1rem; }
.muted { color:#aab7d4; }
</style>
{% endblock %}
